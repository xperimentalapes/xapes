<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Xperimental Mutant Apes Slot Machine">
    <title>XMA Slot Machine | Xperimental Mutant Apes</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="slots.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script type="module">
        // Load SPL token library dynamically
        import('https://esm.sh/@solana/spl-token@0.3.9').then(splToken => {
            window.splToken = splToken;
            // Dispatch event when loaded
            window.dispatchEvent(new Event('splTokenLoaded'));
        }).catch(err => {
            console.error('Failed to load SPL token library:', err);
        });
    </script>
</head>
<body class="slots-page">
    <!-- Landscape Orientation Prompt -->
    <div id="orientation-prompt" class="orientation-prompt">
        <div class="orientation-content">
            <div class="orientation-icon">ðŸ“±</div>
            <h2>Please Rotate Your Device</h2>
            <p>This game is best experienced in landscape mode</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo" style="display: flex; align-items: center; gap: 16px;">
                    <a href="/">
                        <img src="/images/logo.png" alt="Xperimental Mutant Apes" class="logo-img">
                    </a>
                    <a href="/" class="exit-home-btn" title="Exit to Homepage">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H9M16 17L21 12M21 12L16 7M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </div>
                <div class="nav-links">
                    <div id="wallet-button-container" class="wallet-button-container">
                        <button id="connect-wallet" class="wallet-connect-btn">Connect Wallet</button>
                        <div id="wallet-info" class="wallet-info" style="display: none;">
                            <span id="wallet-address"></span>
                            <button id="disconnect-wallet" class="wallet-disconnect-btn">Disconnect</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Slot Machine Container -->
    <div class="slots-container">
        <div class="slot-machine-wrapper">
            <!-- Game Stats -->
            <div class="game-stats-bar">
                <div class="stat-item">
                    <span class="stat-label">Balance:</span>
                    <span id="xma-balance" class="stat-value">0 XMA</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Spins Remaining:</span>
                    <span id="spins-remaining" class="stat-value">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Won:</span>
                    <span id="total-won" class="stat-value">0 XMA</span>
                </div>
                <div class="stat-item stat-item-grand-totals">
                    <span class="stat-label">Game Totals:</span>
                    <div class="grand-totals">
                        <span class="grand-total-item">
                            <span class="grand-total-label">Spins:</span>
                            <span id="grand-total-spins" class="grand-total-value">0</span>
                        </span>
                        <span class="grand-total-item">
                            <span class="grand-total-label">Won:</span>
                            <span id="grand-total-won" class="grand-total-value">0 XMA</span>
                        </span>
                    </div>
                </div>
                <button id="prize-structure-btn-desktop" class="btn-win-percent-desktop">win %</button>
                <button id="leaderboard-btn-desktop" class="btn-leaderboard-desktop" title="Leaderboard">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- Slot Machine -->
            <div class="slot-machine-main">
                <div class="reels-container">
                    <div class="reel-wrapper">
                        <div class="reel" id="reel-1">
                            <div class="reel-strip">
                                <!-- Symbols will be generated by JS -->
                            </div>
                        </div>
                    </div>
                    <div class="reel-wrapper">
                        <div class="reel" id="reel-2">
                            <div class="reel-strip">
                                <!-- Symbols will be generated by JS -->
                            </div>
                        </div>
                    </div>
                    <div class="reel-wrapper">
                        <div class="reel" id="reel-3">
                            <div class="reel-strip">
                                <!-- Symbols will be generated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Stats Sidebar -->
                <div class="mobile-stats-sidebar">
                    <div class="mobile-stat-item">
                        <span class="mobile-stat-label">Balance: </span><span id="mobile-xma-balance" class="mobile-stat-value">0 XMA</span>
                    </div>
                    <div class="mobile-stat-item">
                        <span class="mobile-stat-label">Spins Remaining: </span><span id="mobile-spins-remaining" class="mobile-stat-value">0</span>
                    </div>
                    <div class="mobile-stat-item">
                        <span class="mobile-stat-label">Total Won: </span><span id="mobile-total-won" class="mobile-stat-value">0 XMA</span>
                    </div>
                    <button id="prize-structure-btn" class="btn-win-percent">win %</button>
                </div>
                
                <!-- Win Display -->
                <div id="win-display" class="win-display" style="display: none;">
                    <h2 id="win-message"></h2>
                    <p id="win-amount"></p>
                </div>
            </div>

            <!-- Controls -->
            <div class="controls-panel">
                <div class="inputs-row">
                    <div class="control-group">
                        <label for="cost-per-spin">Cost Per Spin (XMA):</label>
                        <input type="number" id="cost-per-spin" min="1" value="1" step="0.1">
                    </div>
                    
                    <div class="control-group">
                        <label for="number-of-spins">Number of Spins:</label>
                        <input type="number" id="number-of-spins" min="1" value="1" step="1">
                    </div>
                </div>

                <div class="button-group">
                    <button id="purchase-spins" class="btn btn-primary" disabled>BUY</button>
                    <button id="spin-button" class="btn btn-spin" disabled>
                        <span class="spin-button-main">SPIN</span>
                        <span id="spin-button-hint" class="spin-button-hint">DOUBLE CLICK FOR AUTOSPIN</span>
                    </button>
                    <button id="withdraw-button" class="btn btn-withdraw" disabled>COLLECT</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Prize Structure Modal -->
    <div id="prize-modal" class="prize-modal">
        <div class="prize-modal-content">
            <div class="prize-modal-header">
                <button id="close-prize-modal" class="close-modal-btn">&times;</button>
            </div>
            <div class="prize-modal-body">
                <p class="prize-info">Match 3 symbols to win</p>
                <div class="prize-columns">
                    <div class="prize-column prize-column-left">
                        <div class="prize-item"><img src="/images/symbols/8.png" alt="Grapes" class="prize-symbol-image"><img src="/images/symbols/8.png" alt="Grapes" class="prize-symbol-image"><img src="/images/symbols/8.png" alt="Grapes" class="prize-symbol-image">: x13</div>
                        <div class="prize-item"><img src="/images/symbols/7.png" alt="Cherry" class="prize-symbol-image"><img src="/images/symbols/7.png" alt="Cherry" class="prize-symbol-image"><img src="/images/symbols/7.png" alt="Cherry" class="prize-symbol-image">: x16</div>
                        <div class="prize-item"><img src="/images/symbols/6.png" alt="Lemon" class="prize-symbol-image"><img src="/images/symbols/6.png" alt="Lemon" class="prize-symbol-image"><img src="/images/symbols/6.png" alt="Lemon" class="prize-symbol-image">: x21</div>
                        <div class="prize-item"><img src="/images/symbols/5.png" alt="Orange" class="prize-symbol-image"><img src="/images/symbols/5.png" alt="Orange" class="prize-symbol-image"><img src="/images/symbols/5.png" alt="Orange" class="prize-symbol-image">: x35</div>
                    </div>
                    <div class="prize-column prize-column-right">
                        <div class="prize-item"><img src="/images/symbols/4.png" alt="Watermelon" class="prize-symbol-image"><img src="/images/symbols/4.png" alt="Watermelon" class="prize-symbol-image"><img src="/images/symbols/4.png" alt="Watermelon" class="prize-symbol-image">: x70</div>
                        <div class="prize-item"><img src="/images/symbols/3.png" alt="Star" class="prize-symbol-image"><img src="/images/symbols/3.png" alt="Star" class="prize-symbol-image"><img src="/images/symbols/3.png" alt="Star" class="prize-symbol-image">: x165</div>
                        <div class="prize-item"><img src="/images/symbols/2.png" alt="Diamond" class="prize-symbol-image"><img src="/images/symbols/2.png" alt="Diamond" class="prize-symbol-image"><img src="/images/symbols/2.png" alt="Diamond" class="prize-symbol-image">: x550</div>
                        <div class="prize-item"><img src="/images/symbols/1.png" alt="Seven" class="prize-symbol-image"><img src="/images/symbols/1.png" alt="Seven" class="prize-symbol-image"><img src="/images/symbols/1.png" alt="Seven" class="prize-symbol-image">: x3300</div>
                    </div>
                </div>
                <div class="prize-footer">
                    <p class="prize-small-print">* average payout 80%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="leaderboard-modal">
        <div class="leaderboard-modal-content">
            <div class="leaderboard-modal-header">
                <h2>Leaderboard</h2>
                <button id="close-leaderboard-modal" class="close-modal-btn">&times;</button>
            </div>
            <div class="leaderboard-modal-body">
                <div class="leaderboard-controls">
                    <label for="leaderboard-sort">Sort by:</label>
                    <select id="leaderboard-sort" class="leaderboard-sort">
                        <option value="spins">Total Spins</option>
                        <option value="won">Total Won</option>
                        <option value="winRate">Win %</option>
                    </select>
                </div>
                <div id="leaderboard-loading" class="leaderboard-loading" style="display: none;">Loading...</div>
                <div id="leaderboard-error" class="leaderboard-error" style="display: none;"></div>
                <div id="leaderboard-list" class="leaderboard-list"></div>
            </div>
        </div>
    </div>

    <script src="slots.js"></script>
</body>
</html>
